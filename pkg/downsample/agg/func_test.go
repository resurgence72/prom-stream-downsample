package agg

import (
	"fmt"
	"testing"

	"github.com/prometheus/prometheus/prompb"

	"prom-stream-downsample/pkg/pb"
)

func TestFunc(t *testing.T) {
	fn := aggFnMap["lttb"]

	ts := []int64{
		1702286820000,
		1702286880000,
		1702286940000,
		1702287000000,
		1702287060000,
		1702287120000,
		1702287180000,
		1702287240000,
		1702287300000,
		1702287360000,
		1702287420000,
		1702287480000,
		1702287540000,
		1702287600000,
		1702287660000,
		1702287720000,
		1702287780000,
		1702287840000,
		1702287900000,
		1702287960000,
		1702288020000,
		1702288080000,
		1702288140000,
		1702288200000,
		1702288260000,
		1702288320000,
		1702288380000,
		1702288440000,
		1702288500000,
		1702288560000,
		1702288620000,
	}

	values := []float64{
		314590,
		314976,
		314582,
		314113,
		306762,
		315178,
		312649,
		312677,
		312667,
		300323,
		299954,
		296546,
		296074,
		296548,
		299393,
		319441,
		319402,
		319444,
		319466,
		319803,
		2417,
		2496,
		2542,
		298215,
		297672,
		298091,
		298096,
		297873,
		4120,
		4098,
		4067,
	}

	var points []pb.Point
	for i := range ts {
		points = append(points, pb.Point{
			Timestamp: ts[i],
			Value:     values[i],
		})
	}

	res := fn(points).([]prompb.Sample)
	fmt.Println(res)
}
